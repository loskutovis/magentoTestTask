<?xml version="1.0" ?>
<config>
    <modules>
        <Ilosk_GoodsInsurance>
            <version>1.0.0</version>
        </Ilosk_GoodsInsurance>
    </modules>
    <frontend>
        <layout>
            <updates>
                <goodsinsurance>
                    <file>goodsinsurance.xml</file>
                </goodsinsurance>
            </updates>
        </layout>
    </frontend>
    <global>
        <blocks>
            <goodsinsurance>
                <class>Ilosk_GoodsInsurance_Block</class>
            </goodsinsurance>
        </blocks>
        <fieldsets>
            <sales_convert_quote>
                <goodsinsurance_amount><to_order>*</to_order></goodsinsurance_amount>
            </sales_convert_quote>
        </fieldsets>
        <blocks>
            <adminhtml>
                <rewrite>
                    <sales_order_totals>Ilosk_GoodsInsurance_Block_Adminhtml_Total_Quote</sales_order_totals>
                    <sales_order_invoice_totals>Ilosk_GoodsInsurance_Block_Adminhtml_Total_Invoice</sales_order_invoice_totals>
                    <sales_order_creditmemo_totals>Ilosk_GoodsInsurance_Block_Adminhtml_Total_Creditmemo</sales_order_creditmemo_totals>
                </rewrite>
            </adminhtml>
            <sales>
                <rewrite>
                    <order_totals>Ilosk_GoodsInsurance_Block_Frontend_Total_Quote</order_totals>
                    <order_invoice_totals>Ilosk_GoodsInsurance_Block_Frontend_Total_Invoice</order_invoice_totals>
                    <order_creditmemo_totals>Ilosk_GoodsInsurance_Block_Frontend_Total_Creditmemo</order_creditmemo_totals>
                </rewrite>
            </sales>
        </blocks>
        <resources>
            <ilosk_goodsinsurance_setup>
                <setup>
                    <module>Ilosk_GoodsInsurance</module>
                </setup>
            </ilosk_goodsinsurance_setup>
        </resources>
        <helpers>
            <goodsinsurance>
                <class>Ilosk_GoodsInsurance_Helper</class>
            </goodsinsurance>
        </helpers>
        <sales>
            <quote>
                <totals>
                    <goodsinsurance>
                        <class>Ilosk_GoodsInsurance_Model_Total_Quote</class>
                        <after>subtotal</after>
                    </goodsinsurance>
                </totals>
            </quote>
            <order_invoice>
                <totals>
                    <goodsinsurance>
                        <class>Ilosk_GoodsInsurance_Model_Total_Invoice</class>
                        <after>subtotal</after>
                    </goodsinsurance>
                </totals>
            </order_invoice>
            <order_creditmemo>
                <totals>
                    <goodsinsurance>
                        <class>Ilosk_GoodsInsurance_Model_Total_Creditmemo</class>
                        <after>subtotal</after>
                    </goodsinsurance>
                </totals>
            </order_creditmemo>
        </sales>
        <settings>
            <goodsinsurance>
                <carrier>
                    <fields>
                        <goodsinsurance_active translate="label">
                            <label>Add insurance</label>
                            <frontend_type>select</frontend_type>
                            <source_model>adminhtml/system_config_source_yesno</source_model>
                            <sort_order>10000</sort_order>
                            <show_in_default>1</show_in_default>
                            <show_in_website>1</show_in_website>
                            <show_in_store>1</show_in_store>
                        </goodsinsurance_active>
                        <goodsinsurance_type translate="label">
                            <label>Insurance type</label>
                            <frontend_type>select</frontend_type>
                            <source_model>Ilosk_GoodsInsurance_Model_Type</source_model>
                            <sort_order>10001</sort_order>
                            <show_in_default>1</show_in_default>
                            <show_in_website>1</show_in_website>
                            <show_in_store>1</show_in_store>
                            <depends>
                                <goodsinsurance_active>1</goodsinsurance_active>
                            </depends>
                        </goodsinsurance_type>
                        <goodsinsurance_value translate="label">
                            <label>Insurance value</label>
                            <frontend_type>text</frontend_type>
                            <validate>required-entry validate-number validate-greater-than-zero</validate>
                            <sort_order>10002</sort_order>
                            <show_in_default>1</show_in_default>
                            <show_in_website>1</show_in_website>
                            <show_in_store>1</show_in_store>
                            <depends>
                                <goodsinsurance_active>1</goodsinsurance_active>
                            </depends>
                        </goodsinsurance_value>
                    </fields>
                </carrier>
                <goodsinsurance>
                    <fixed>
                        <class>Ilosk_GoodsInsurance_Model_GoodsInsurance_Fixed</class>
                        <label>Fixed</label>
                    </fixed>
                    <percent>
                        <class>Ilosk_GoodsInsurance_Model_GoodsInsurance_Percent</class>
                        <label>Percent</label>
                    </percent>
                </goodsinsurance>
            </goodsinsurance>
        </settings>
        <events>
            <adminhtml_init_system_config>
                <observers>
                    <goodsinsurance_init_system_config>
                        <class>Ilosk_GoodsInsurance_Observer_Config</class>
                        <method>extendCarrier</method>
                    </goodsinsurance_init_system_config>
                </observers>
            </adminhtml_init_system_config>
            <checkout_controller_onepage_save_shipping_method>
                <observers>
                    <goodsinsurance_observer>
                        <type>singleton</type>
                        <class>Ilosk_GoodsInsurance_Observer_Insurance</class>
                        <method>setQuoteAddressInsurance</method>
                    </goodsinsurance_observer>
                </observers>
            </checkout_controller_onepage_save_shipping_method>
            <sales_order_save_after>
                <observers>
                    <goodsinsurance_observer>
                        <type>singleton</type>
                        <class>Ilosk_GoodsInsurance_Observer_Insurance</class>
                        <method>setOrderInsurance</method>
                    </goodsinsurance_observer>
                </observers>
            </sales_order_save_after>
        </events>
    </global>
</config>
